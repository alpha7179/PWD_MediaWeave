# API Specification

> **Media Weave** RESTful API 명세서
> 
> 본 문서는 클라이언트와 서버 간 통신을 위한 API 엔드포인트, 요청/응답 형식, 에러 코드를 정의합니다.

---

## 1. API 개요 (API Overview)

### 1.1. Base URL

```
Development: http://localhost:3000/api/v1
Production:  https://api.mediaweave.ajou.ac.kr/api/v1
```

### 1.2. 공통 응답 형식

#### 성공 응답

```json
{
  "success": true,
  "data": { ... },
  "message": "Operation successful",
  "timestamp": "2024-11-10T12:34:56.789Z"
}
```

#### 에러 응답

```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Invalid input data",
    "details": [
      {
        "field": "email",
        "message": "Email is required"
      }
    ]
  },
  "timestamp": "2024-11-10T12:34:56.789Z"
}
```

### 1.3. 인증 및 인가 (Authentication & Authorization)

#### 1.3.1. 인증 방식

**JWT (JSON Web Token) Bearer Token** 사용

요청 헤더에 포함:

```http
Authorization: Bearer <access_token>
```

#### 1.3.2. JWT 페이로드 구조

**Access Token 페이로드:**

```json
{
  "user_id": "550e8400-e29b-41d4-a716-446655440000",
  "email": "student@ajou.ac.kr",
  "role": "STUDENT",
  "track_id": 1,
  "iat": 1699620000,
  "exp": 1699623600
}
```

**필드 설명:**
- `user_id` (string): 사용자 고유 식별자 (UUID v4)
- `email` (string): 사용자 이메일
- `role` (string): 사용자 역할 (STUDENT, PROFESSOR, ADMIN)
- `track_id` (integer): 사용자 트랙 ID
- `iat` (integer): 토큰 발급 시간 (Unix timestamp)
- `exp` (integer): 토큰 만료 시간 (Unix timestamp)

**Refresh Token 페이로드:**

```json
{
  "user_id": "550e8400-e29b-41d4-a716-446655440000",
  "type": "refresh",
  "iat": 1699620000,
  "exp": 1702212000
}
```

**필드 설명:**
- `user_id` (string): 사용자 고유 식별자
- `type` (string): 토큰 타입 ("refresh")
- `iat` (integer): 토큰 발급 시간
- `exp` (integer): 토큰 만료 시간

#### 1.3.3. 토큰 유효기간

| 토큰 타입 | 유효기간 | 용도 |
|----------|---------|------|
| Access Token | 1시간 (3600초) | API 요청 인증 |
| Refresh Token | 30일 (2592000초) | Access Token 갱신 |

#### 1.3.4. 토큰 갱신 로직

**토큰 갱신 플로우:**

```mermaid
sequenceDiagram
    participant Client
    participant API
    participant DB
    
    Client->>API: POST /api/v1/auth/refresh
    Note over Client,API: Refresh Token 포함
    
    API->>API: Refresh Token 검증
    
    alt Token 유효
        API->>DB: 사용자 정보 조회
        DB-->>API: 사용자 데이터
        API->>API: 새 Access Token 생성
        API-->>Client: 200 OK + Access Token
    else Token 만료 또는 무효
        API-->>Client: 401 Unauthorized
        Note over Client: 로그인 페이지로 리다이렉트
    end
```

**토큰 갱신 시나리오:**

1. **정상 갱신:**
   - Refresh Token이 유효한 경우
   - 새로운 Access Token 발급
   - Refresh Token은 재사용 가능 (만료 전까지)

2. **갱신 실패:**
   - Refresh Token 만료
   - Refresh Token 손상 또는 위조
   - 사용자 계정 비활성화
   - → 재로그인 필요

#### 1.3.5. 역할 기반 접근 제어 (RBAC)

**사용자 역할:**

| 역할 | 코드 | 설명 |
|------|------|------|
| 학생 | `STUDENT` | 일반 학생 사용자 |
| 교수 | `PROFESSOR` | 교수 사용자 |
| 관리자 | `ADMIN` | 시스템 관리자 |

**역할별 권한 매트릭스:**

| 기능 | STUDENT | PROFESSOR | ADMIN |
|------|---------|-----------|-------|
| 프로젝트 조회 | ✅ | ✅ | ✅ |
| 프로젝트 생성 | ✅ | ✅ | ✅ |
| 자신의 프로젝트 수정 | ✅ | ✅ | ✅ |
| 타인의 프로젝트 수정 | ❌ | ❌ | ✅ |
| 프로젝트 삭제 | ✅ (본인) | ✅ (본인) | ✅ (모두) |
| 커리큘럼 생성 | ✅ | ✅ | ✅ |
| 커리큘럼 공유 | ✅ | ✅ | ✅ |
| 과목 정보 수정 | ❌ | ✅ | ✅ |
| 트랙 정보 수정 | ❌ | ❌ | ✅ |
| 사용자 관리 | ❌ | ❌ | ✅ |
| 시스템 설정 | ❌ | ❌ | ✅ |

#### 1.3.6. 권한 체크 방법

**서버 측 권한 검증 (Express.js 예시):**

```typescript
// 인증 미들웨어
const authenticate = async (req, res, next) => {
  try {
    const token = req.headers.authorization?.replace('Bearer ', '');
    
    if (!token) {
      throw new ApiError('UNAUTHORIZED', 'Authentication token is required', 401);
    }
    
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    req.user = decoded;
    next();
  } catch (error) {
    if (error.name === 'TokenExpiredError') {
      throw new ApiError('TOKEN_EXPIRED', 'Token has expired', 401);
    }
    throw new ApiError('INVALID_TOKEN', 'Invalid authentication token', 401);
  }
};

// 역할 기반 권한 미들웨어
const authorize = (...allowedRoles: string[]) => {
  return (req, res, next) => {
    if (!req.user) {
      throw new ApiError('UNAUTHORIZED', 'Authentication required', 401);
    }
    
    if (!allowedRoles.includes(req.user.role)) {
      throw new ApiError(
        'FORBIDDEN',
        'You do not have permission to access this resource',
        403,
        [{ field: 'user_role', message: `Only ${allowedRoles.join(', ')} roles can perform this action` }]
      );
    }
    
    next();
  };
};

// 리소스 소유권 검증 미들웨어
const checkOwnership = (resourceType: string) => {
  return async (req, res, next) => {
    const resourceId = req.params.id;
    const userId = req.user.user_id;
    
    // 관리자는 모든 리소스 접근 가능
    if (req.user.role === 'ADMIN') {
      return next();
    }
    
    // 리소스 소유자 확인
    const resource = await getResource(resourceType, resourceId);
    
    if (!resource) {
      throw new ApiError('NOT_FOUND', `${resourceType} not found`, 404);
    }
    
    if (resource.user_id !== userId) {
      throw new ApiError(
        'FORBIDDEN',
        'You can only modify your own resources',
        403
      );
    }
    
    next();
  };
};

// 사용 예시
app.delete(
  '/api/v1/projects/:id',
  authenticate,
  checkOwnership('project'),
  deleteProject
);

app.patch(
  '/api/v1/courses/:id',
  authenticate,
  authorize('PROFESSOR', 'ADMIN'),
  updateCourse
);
```

#### 1.3.7. 토큰 저장 및 관리 (클라이언트)

**권장 저장 방식:**

```typescript
// Access Token: 메모리 또는 sessionStorage (XSS 공격 방지)
// Refresh Token: httpOnly 쿠키 (XSS 및 CSRF 공격 방지)

class AuthService {
  private accessToken: string | null = null;
  
  // 로그인
  async login(email: string, password: string) {
    const response = await fetch('/api/v1/auth/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, password }),
      credentials: 'include' // 쿠키 포함
    });
    
    const data = await response.json();
    
    if (data.success) {
      // Access Token은 메모리에 저장
      this.accessToken = data.data.accessToken;
      // Refresh Token은 서버에서 httpOnly 쿠키로 설정
      return data.data.user;
    }
    
    throw new Error(data.error.message);
  }
  
  // Access Token 가져오기
  getAccessToken(): string | null {
    return this.accessToken;
  }
  
  // 토큰 갱신
  async refreshAccessToken() {
    const response = await fetch('/api/v1/auth/refresh', {
      method: 'POST',
      credentials: 'include' // Refresh Token 쿠키 포함
    });
    
    const data = await response.json();
    
    if (data.success) {
      this.accessToken = data.data.accessToken;
      return this.accessToken;
    }
    
    // 갱신 실패 시 로그아웃
    this.logout();
    throw new Error('Token refresh failed');
  }
  
  // API 요청 (자동 토큰 갱신 포함)
  async apiCall(url: string, options: RequestInit = {}) {
    // 첫 번째 시도
    let response = await fetch(url, {
      ...options,
      headers: {
        ...options.headers,
        'Authorization': `Bearer ${this.accessToken}`
      }
    });
    
    // 401 에러 시 토큰 갱신 후 재시도
    if (response.status === 401) {
      await this.refreshAccessToken();
      
      response = await fetch(url, {
        ...options,
        headers: {
          ...options.headers,
          'Authorization': `Bearer ${this.accessToken}`
        }
      });
    }
    
    return response;
  }
  
  // 로그아웃
  async logout() {
    await fetch('/api/v1/auth/logout', {
      method: 'POST',
      credentials: 'include'
    });
    
    this.accessToken = null;
    // 로그인 페이지로 리다이렉트
    window.location.href = '/login';
  }
}
```

#### 1.3.8. 보안 고려사항

**토큰 보안:**
- Access Token은 짧은 유효기간 (1시간) 설정
- Refresh Token은 httpOnly 쿠키로 저장하여 XSS 공격 방지
- HTTPS 통신 필수
- CSRF 토큰 사용 권장

**비밀번호 보안:**
- Bcrypt 해싱 (salt rounds: 10)
- 최소 8자, 영문+숫자+특수문자 조합 필수
- 비밀번호 재사용 방지 (최근 3개)

**Rate Limiting:**
- 로그인 API: 15분당 5회
- 토큰 갱신 API: 15분당 10회
- 일반 API: 15분당 100회

### 1.4. HTTP 상태 코드

| 코드 | 의미 | 설명 |
|------|------|------|
| 200 | OK | 요청 성공 |
| 201 | Created | 리소스 생성 성공 |
| 400 | Bad Request | 잘못된 요청 |
| 401 | Unauthorized | 인증 실패 |
| 403 | Forbidden | 권한 없음 |
| 404 | Not Found | 리소스 없음 |
| 409 | Conflict | 중복 데이터 |
| 500 | Internal Server Error | 서버 오류 |

---

## 2. 인증 API (Authentication)

### 2.1. 회원가입

**HTTP Method:** `POST`  
**URL:** `/api/v1/auth/register`  
**인증 필요:** 없음

**Request Headers:**

```http
Content-Type: application/json
```

**Request Body:**

```json
{
  "email": "student@ajou.ac.kr",
  "password": "SecurePass123!",
  "name": "홍길동",
  "student_id": "202221046",
  "major_id": 1,
  "track_id": 3,
  "grade_level": 2
}
```

**Validation Rules:**
- `email`: 필수, 이메일 형식, 중복 불가
- `password`: 필수, 최소 8자, 영문+숫자+특수문자 조합
- `student_id`: 필수, 9자리 숫자
- `major_id`, `track_id`: 필수, 존재하는 ID

**Success Response (201 Created):**

```json
{
  "success": true,
  "data": {
    "user": {
      "user_id": "550e8400-e29b-41d4-a716-446655440000",
      "email": "student@ajou.ac.kr",
      "name": "홍길동",
      "role": "STUDENT"
    },
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTUwZTg0MDAtZTI5Yi00MWQ0LWE3MTYtNDQ2NjU1NDQwMDAwIiwicm9sZSI6IlNUVURFTlQiLCJpYXQiOjE2OTk2MjAwMDAsImV4cCI6MTY5OTYyMzYwMH0.abc123",
    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTUwZTg0MDAtZTI5Yi00MWQ0LWE3MTYtNDQ2NjU1NDQwMDAwIiwidHlwZSI6InJlZnJlc2giLCJpYXQiOjE2OTk2MjAwMDAsImV4cCI6MTcwMjIxMjAwMH0.def456"
  },
  "message": "Registration successful",
  "timestamp": "2024-11-10T12:34:56.789Z"
}
```

**Error Response (400 Bad Request) - 유효성 검증 실패:**

```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Invalid input data",
    "details": [
      {
        "field": "email",
        "message": "Email format is invalid"
      },
      {
        "field": "password",
        "message": "Password must contain at least 8 characters with letters, numbers, and special characters"
      }
    ]
  },
  "timestamp": "2024-11-10T12:34:56.789Z"
}
```

**Error Response (409 Conflict) - 이메일 중복:**

```json
{
  "success": false,
  "error": {
    "code": "DUPLICATE_EMAIL",
    "message": "Email already exists",
    "details": [
      {
        "field": "email",
        "message": "student@ajou.ac.kr is already registered"
      }
    ]
  },
  "timestamp": "2024-11-10T12:34:56.789Z"
}
```

**Error Response (404 Not Found) - 존재하지 않는 트랙/전공:**

```json
{
  "success": false,
  "error": {
    "code": "NOT_FOUND",
    "message": "Track or Major not found",
    "details": [
      {
        "field": "track_id",
        "message": "Track with ID 999 does not exist"
      }
    ]
  },
  "timestamp": "2024-11-10T12:34:56.789Z"
}
```

---

### 2.2. 로그인

**HTTP Method:** `POST`  
**URL:** `/api/v1/auth/login`  
**인증 필요:** 없음

**Request Headers:**

```http
Content-Type: application/json
```

**Request Body:**

```json
{
  "email": "student@ajou.ac.kr",
  "password": "SecurePass123!"
}
```

**Success Response (200 OK):**

```json
{
  "success": true,
  "data": {
    "user": {
      "user_id": "550e8400-e29b-41d4-a716-446655440000",
      "email": "student@ajou.ac.kr",
      "name": "홍길동",
      "role": "STUDENT",
      "track": {
        "track_id": 3,
        "name_ko": "게임앤인터랙티브콘텐츠"
      }
    },
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTUwZTg0MDAtZTI5Yi00MWQ0LWE3MTYtNDQ2NjU1NDQwMDAwIiwicm9sZSI6IlNUVURFTlQiLCJpYXQiOjE2OTk2MjAwMDAsImV4cCI6MTY5OTYyMzYwMH0.abc123",
    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTUwZTg0MDAtZTI5Yi00MWQ0LWE3MTYtNDQ2NjU1NDQwMDAwIiwidHlwZSI6InJlZnJlc2giLCJpYXQiOjE2OTk2MjAwMDAsImV4cCI6MTcwMjIxMjAwMH0.def456"
  },
  "message": "Login successful",
  "timestamp": "2024-11-10T12:34:56.789Z"
}
```

**Error Response (400 Bad Request) - 필수 필드 누락:**

```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Invalid input data",
    "details": [
      {
        "field": "email",
        "message": "Email is required"
      }
    ]
  },
  "timestamp": "2024-11-10T12:34:56.789Z"
}
```

**Error Response (401 Unauthorized) - 잘못된 인증 정보:**

```json
{
  "success": false,
  "error": {
    "code": "INVALID_CREDENTIALS",
    "message": "Invalid email or password",
    "details": []
  },
  "timestamp": "2024-11-10T12:34:56.789Z"
}
```


### 2.3. 토큰 갱신

**HTTP Method:** `POST`  
**URL:** `/api/v1/auth/refresh`  
**인증 필요:** 없음 (Refresh Token 필요)

**Request Headers:**

```http
Content-Type: application/json
```

**Request Body:**

```json
{
  "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTUwZTg0MDAtZTI5Yi00MWQ0LWE3MTYtNDQ2NjU1NDQwMDAwIiwidHlwZSI6InJlZnJlc2giLCJpYXQiOjE2OTk2MjAwMDAsImV4cCI6MTcwMjIxMjAwMH0.def456"
}
```

**Success Response (200 OK):**

```json
{
  "success": true,
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTUwZTg0MDAtZTI5Yi00MWQ0LWE3MTYtNDQ2NjU1NDQwMDAwIiwicm9sZSI6IlNUVURFTlQiLCJpYXQiOjE2OTk2MjM2MDAsImV4cCI6MTY5OTYyNzIwMH0.xyz789"
  },
  "message": "Token refreshed successfully",
  "timestamp": "2024-11-10T13:00:00.000Z"
}
```

**Error Response (401 Unauthorized) - 유효하지 않은 Refresh Token:**

```json
{
  "success": false,
  "error": {
    "code": "UNAUTHORIZED",
    "message": "Invalid or expired refresh token",
    "details": []
  },
  "timestamp": "2024-11-10T13:00:00.000Z"
}
```

**Error Response (400 Bad Request) - Refresh Token 누락:**

```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Refresh token is required",
    "details": [
      {
        "field": "refreshToken",
        "message": "refreshToken field is required"
      }
    ]
  },
  "timestamp": "2024-11-10T13:00:00.000Z"
}
```

---

### 2.4. 로그아웃

**HTTP Method:** `POST`  
**URL:** `/api/v1/auth/logout`  
**인증 필요:** 예

**Request Headers:**

```http
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTUwZTg0MDAtZTI5Yi00MWQ0LWE3MTYtNDQ2NjU1NDQwMDAwIiwicm9sZSI6IlNUVURFTlQiLCJpYXQiOjE2OTk2MjAwMDAsImV4cCI6MTY5OTYyMzYwMH0.abc123
Content-Type: application/json
```

**Request Body:** 없음

**Success Response (200 OK):**

```json
{
  "success": true,
  "message": "Logout successful",
  "timestamp": "2024-11-10T13:30:00.000Z"
}
```

**Error Response (401 Unauthorized) - 토큰 없음:**

```json
{
  "success": false,
  "error": {
    "code": "UNAUTHORIZED",
    "message": "Authentication token is required",
    "details": []
  },
  "timestamp": "2024-11-10T13:30:00.000Z"
}
```

**Error Response (401 Unauthorized) - 만료된 토큰:**

```json
{
  "success": false,
  "error": {
    "code": "UNAUTHORIZED",
    "message": "Token has expired",
    "details": []
  },
  "timestamp": "2024-11-10T13:30:00.000Z"
}
```

---

## 3. 트랙 & 과목 API (Tracks & Courses)

### 3.1. 트랙 목록 조회

**HTTP Method:** `GET`  
**URL:** `/api/v1/tracks`  
**인증 필요:** 없음

**Request Headers:**

```http
Content-Type: application/json
```

**Query Parameters:** 없음

**Success Response (200 OK):**

```json
{
  "success": true,
  "data": [
    {
      "track_id": 1,
      "initials": "GI",
      "name_ko": "게임앤인터랙티브콘텐츠",
      "name_en": "Game & Interactive Contents",
      "description": "게임 및 인터랙티브 미디어 제작"
    },
    {
      "track_id": 2,
      "initials": "VC",
      "name_ko": "영상콘텐츠",
      "name_en": "Visual Contents",
      "description": "영상 제작 및 편집"
    },
    {
      "track_id": 3,
      "initials": "CD",
      "name_ko": "문화콘텐츠디자인",
      "name_en": "Cultural Contents Design",
      "description": "문화 콘텐츠 기획 및 디자인"
    }
  ],
  "message": "Tracks retrieved successfully",
  "timestamp": "2024-11-10T14:00:00.000Z"
}
```

**Error Response (500 Internal Server Error) - 서버 오류:**

```json
{
  "success": false,
  "error": {
    "code": "INTERNAL_ERROR",
    "message": "Failed to retrieve tracks",
    "details": []
  },
  "timestamp": "2024-11-10T14:00:00.000Z"
}
```


### 3.2. 트랙 로드맵 조회

**HTTP Method:** `GET`  
**URL:** `/api/v1/tracks/:trackId/roadmap`  
**인증 필요:** 없음

**Request Headers:**

```http
Content-Type: application/json
```

**Path Parameters:**
- `trackId` (integer, required): 트랙 ID (예: 1, 2, 3)

**Query Parameters:** 없음

**Success Response (200 OK):**

```json
{
  "success": true,
  "data": {
    "track": {
      "track_id": 1,
      "name_ko": "게임앤인터랙티브콘텐츠",
      "name_en": "Game & Interactive Contents"
    },
    "nodes": [
      {
        "course_id": 101,
        "course_code": "CSE101",
        "name_ko": "프로그래밍기초",
        "name_en": "Programming Basics",
        "credit": 3,
        "grade_level": 1,
        "position": { "x": 100, "y": 100 }
      },
      {
        "course_id": 201,
        "course_code": "CSE201",
        "name_ko": "자료구조",
        "name_en": "Data Structures",
        "credit": 3,
        "grade_level": 2,
        "position": { "x": 100, "y": 200 }
      }
    ],
    "edges": [
      {
        "source": 101,
        "target": 201,
        "type": "required"
      }
    ]
  },
  "message": "Roadmap retrieved successfully",
  "timestamp": "2024-11-10T14:15:00.000Z"
}
```

**Error Response (404 Not Found) - 존재하지 않는 트랙:**

```json
{
  "success": false,
  "error": {
    "code": "NOT_FOUND",
    "message": "Track not found",
    "details": [
      {
        "field": "trackId",
        "message": "Track with ID 999 does not exist"
      }
    ]
  },
  "timestamp": "2024-11-10T14:15:00.000Z"
}
```

**Error Response (400 Bad Request) - 잘못된 트랙 ID 형식:**

```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Invalid track ID format",
    "details": [
      {
        "field": "trackId",
        "message": "Track ID must be a positive integer"
      }
    ]
  },
  "timestamp": "2024-11-10T14:15:00.000Z"
}
```

---

### 3.3. 과목 상세 조회

**HTTP Method:** `GET`  
**URL:** `/api/v1/courses/:courseId`  
**인증 필요:** 없음

**Request Headers:**

```http
Content-Type: application/json
```

**Path Parameters:**
- `courseId` (integer, required): 과목 ID (예: 101, 201)

**Query Parameters:** 없음

**Success Response (200 OK):**

```json
{
  "success": true,
  "data": {
    "course_id": 101,
    "course_code": "CSE101",
    "name_ko": "프로그래밍기초",
    "name_en": "Programming Basics",
    "credit": 3,
    "grade_level": 1,
    "description": "프로그래밍의 기본 개념과 알고리즘 학습",
    "prerequisites": [
      {
        "course_id": 100,
        "course_code": "CSE100",
        "name_ko": "컴퓨터개론",
        "type": "required"
      }
    ],
    "related_projects": [
      {
        "project_id": "proj-001",
        "title": "게임 프로젝트",
        "thumbnail": "https://s3.mediaweave.ajou.ac.kr/projects/proj-001/thumbnail.jpg",
        "author": "홍길동"
      }
    ]
  },
  "message": "Course details retrieved successfully",
  "timestamp": "2024-11-10T14:30:00.000Z"
}
```

**Error Response (404 Not Found) - 존재하지 않는 과목:**

```json
{
  "success": false,
  "error": {
    "code": "NOT_FOUND",
    "message": "Course not found",
    "details": [
      {
        "field": "courseId",
        "message": "Course with ID 999 does not exist"
      }
    ]
  },
  "timestamp": "2024-11-10T14:30:00.000Z"
}
```

**Error Response (400 Bad Request) - 잘못된 과목 ID 형식:**

```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Invalid course ID format",
    "details": [
      {
        "field": "courseId",
        "message": "Course ID must be a positive integer"
      }
    ]
  },
  "timestamp": "2024-11-10T14:30:00.000Z"
}
```

---

## 4. 커리큘럼 API (Curriculum)

### 4.1. 커리큘럼 생성

**HTTP Method:** `POST`  
**URL:** `/api/v1/curriculums`  
**인증 필요:** 예

**Request Headers:**

```http
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTUwZTg0MDAtZTI5Yi00MWQ0LWE3MTYtNDQ2NjU1NDQwMDAwIiwicm9sZSI6IlNUVURFTlQiLCJpYXQiOjE2OTk2MjAwMDAsImV4cCI6MTY5OTYyMzYwMH0.abc123
Content-Type: application/json
```

**Request Body:**

```json
{
  "title": "GI 트랙 4년 플랜",
  "description": "게임 개발자를 위한 커리큘럼",
  "semesters": {
    "1-1": [
      {
        "course_id": 101,
        "course_code": "CSE101",
        "course_name": "프로그래밍기초",
        "credit": 3,
        "status": "completed"
      }
    ],
    "1-2": [
      {
        "course_id": 102,
        "course_code": "CSE102",
        "course_name": "자료구조",
        "credit": 3,
        "status": "planned"
      }
    ]
  },
  "isPublic": false
}
```

**Success Response (201 Created):**

```json
{
  "success": true,
  "data": {
    "curriculum_id": "64a1b2c3d4e5f6g7h8i9j0k1",
    "user_id": "550e8400-e29b-41d4-a716-446655440000",
    "title": "GI 트랙 4년 플랜",
    "description": "게임 개발자를 위한 커리큘럼",
    "isPublic": false,
    "created_at": "2024-11-10T15:00:00.000Z",
    "updated_at": "2024-11-10T15:00:00.000Z"
  },
  "message": "Curriculum created successfully",
  "timestamp": "2024-11-10T15:00:00.000Z"
}
```

**Error Response (400 Bad Request) - 유효성 검증 실패:**

```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Invalid input data",
    "details": [
      {
        "field": "title",
        "message": "Title is required and must be between 1 and 100 characters"
      },
      {
        "field": "semesters",
        "message": "Semesters object is required"
      }
    ]
  },
  "timestamp": "2024-11-10T15:00:00.000Z"
}
```

**Error Response (401 Unauthorized) - 인증 실패:**

```json
{
  "success": false,
  "error": {
    "code": "UNAUTHORIZED",
    "message": "Authentication token is required",
    "details": []
  },
  "timestamp": "2024-11-10T15:00:00.000Z"
}
```

**Error Response (404 Not Found) - 존재하지 않는 과목:**

```json
{
  "success": false,
  "error": {
    "code": "NOT_FOUND",
    "message": "One or more courses not found",
    "details": [
      {
        "field": "semesters.1-1[0].course_id",
        "message": "Course with ID 999 does not exist"
      }
    ]
  },
  "timestamp": "2024-11-10T15:00:00.000Z"
}
```

---

### 4.2. 내 커리큘럼 목록 조회

**HTTP Method:** `GET`  
**URL:** `/api/v1/curriculums/my`  
**인증 필요:** 예

**Request Headers:**

```http
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTUwZTg0MDAtZTI5Yi00MWQ0LWE3MTYtNDQ2NjU1NDQwMDAwIiwicm9sZSI6IlNUVURFTlQiLCJpYXQiOjE2OTk2MjAwMDAsImV4cCI6MTY5OTYyMzYwMH0.abc123
Content-Type: application/json
```

**Query Parameters:** 없음

**Success Response (200 OK):**

```json
{
  "success": true,
  "data": [
    {
      "curriculum_id": "64a1b2c3d4e5f6g7h8i9j0k1",
      "title": "GI 트랙 4년 플랜",
      "description": "게임 개발자를 위한 커리큘럼",
      "isPublic": false,
      "created_at": "2024-11-10T15:00:00.000Z",
      "updated_at": "2024-11-10T15:30:00.000Z"
    },
    {
      "curriculum_id": "74b2c3d4e5f6g7h8i9j0k1l2",
      "title": "백엔드 개발자 로드맵",
      "description": "서버 개발 중심 커리큘럼",
      "isPublic": true,
      "created_at": "2024-11-05T10:00:00.000Z",
      "updated_at": "2024-11-08T14:20:00.000Z"
    }
  ],
  "message": "Curriculums retrieved successfully",
  "timestamp": "2024-11-10T15:45:00.000Z"
}
```

**Error Response (401 Unauthorized) - 인증 실패:**

```json
{
  "success": false,
  "error": {
    "code": "UNAUTHORIZED",
    "message": "Authentication token is required",
    "details": []
  },
  "timestamp": "2024-11-10T15:45:00.000Z"
}
```

---

### 4.3. 공유된 커리큘럼 조회

```http
GET /api/v1/curriculums/public
```

**Query Parameters:**
- `track_id` (optional): 트랙 필터
- `grade_level` (optional): 학년 필터
- `page` (optional): 페이지 번호 (default: 1)
- `limit` (optional): 페이지 크기 (default: 20)

**Response (200 OK):**

```json
{
  "success": true,
  "data": {
    "curriculums": [
      {
        "curriculum_id": "64a1b2c3d4e5f6g7h8i9j0k1",
        "title": "GI 트랙 4년 플랜",
        "author": {
          "name": "홍길동",
          "track": "GI",
          "grade_level": 4
        },
        "created_at": "2024-11-10T12:34:56.789Z"
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 45
    }
  }
}
```

---

### 4.4. CSV 임포트 (성적표 업로드)

```http
POST /api/v1/curriculums/import-csv
```

**Headers:** 
- `Authorization: Bearer <token>`
- `Content-Type: multipart/form-data`

**Request Body (FormData):**
- `file`: CSV 파일

**Response (200 OK):**

```json
{
  "success": true,
  "data": {
    "parsed_courses": [
      {
        "course_code": "CSE101",
        "course_name": "프로그래밍기초",
        "credit": 3,
        "grade": "A+",
        "semester": "2023-1"
      }
    ],
    "matched_count": 15,
    "unmatched_count": 2
  }
}
```

---

## 5. 프로젝트 API (Projects)

### 5.1. 프로젝트 목록 조회

**HTTP Method:** `GET`  
**URL:** `/api/v1/projects`  
**인증 필요:** 없음

**Request Headers:**

```http
Content-Type: application/json
```

**Query Parameters:**
- `track_type` (string, optional): GI, VC, CD, MD, DE
- `tech_stack` (string, optional): React, Unity, Python (쉼표로 구분)
- `grade_level` (integer, optional): 1, 2, 3, 4
- `sort` (string, optional): latest, popular, views (default: latest)
- `page` (integer, optional): 페이지 번호 (default: 1)
- `limit` (integer, optional): 페이지 크기 (default: 20, max: 100)

**Example Request:**

```http
GET /api/v1/projects?track_type=GI&tech_stack=React,Node.js&sort=popular&page=1&limit=20
```

**Success Response (200 OK):**

```json
{
  "success": true,
  "data": {
    "projects": [
      {
        "project_id": "proj-001",
        "title": "Media Weave Platform",
        "summary": "학과 커뮤니티 플랫폼",
        "thumbnail": "https://s3.../thumbnail.jpg",
        "track_type": "GI",
        "tech_stacks": ["React", "Node.js"],
        "author": {
          "user_id": "uuid",
          "name": "홍길동"
        },
        "stats": {
          "views": 1250,
          "likes": 142
        },
        "created_at": "2024-11-10T12:34:56.789Z"
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 87
    }
  }
}
```

---

### 5.2. 프로젝트 상세 조회

```http
GET /api/v1/projects/:projectId
```

**Response (200 OK):**

```json
{
  "success": true,
  "data": {
    "project_id": "proj-001",
    "title": "Media Weave Platform",
    "summary": "학과 커뮤니티 플랫폼",
    "content_markdown": "# 프로젝트 소개\n...",
    "track_type": "GI",
    "tech_stacks": ["React", "Node.js", "PostgreSQL"],
    "media_list": [
      {
        "type": "image",
        "url": "https://s3.../image1.jpg",
        "caption": "메인 화면"
      }
    ],
    "linked_course": {
      "course_id": 301,
      "course_name": "몰입형미디어프로그래밍"
    },
    "team_members": [
      {
        "user_id": "uuid",
        "name": "홍길동",
        "role": "Frontend Lead",
        "is_verified": true
      }
    ],
    "stats": {
      "views": 1250,
      "likes": 142
    },
    "user_interaction": {
      "is_liked": false,
      "is_scrapped": true
    },
    "created_at": "2024-11-10T12:34:56.789Z"
  }
}
```

---

### 5.3. 프로젝트 생성

```http
POST /api/v1/projects
```

**Headers:** 
- `Authorization: Bearer <token>`
- `Content-Type: multipart/form-data`

**Request Body (FormData):**
- `title`: 프로젝트 제목
- `summary`: 한 줄 소개
- `content_markdown`: 상세 내용 (Markdown)
- `track_type`: GI, VC, CD, MD, DE
- `tech_stacks`: ["React", "Node.js"] (JSON string)
- `linked_course_id`: 연관 과목 ID (optional)
- `team_members`: [{"user_id": "uuid", "role": "Frontend"}] (JSON string)
- `files`: 이미지/동영상 파일 (multiple)

**Response (201 Created):**

```json
{
  "success": true,
  "data": {
    "project_id": "proj-002",
    "title": "Media Weave Platform",
    "created_at": "2024-11-10T12:34:56.789Z"
  }
}
```

---

### 5.4. 프로젝트 좋아요

```http
POST /api/v1/projects/:projectId/like
```

**Headers:** `Authorization: Bearer <token>`

**Response (200 OK):**

```json
{
  "success": true,
  "data": {
    "is_liked": true,
    "like_count": 143
  }
}
```

---

### 5.5. 프로젝트 수정

```http
PATCH /api/v1/projects/:projectId
```

**Headers:** `Authorization: Bearer <token>`

**Request Body:** (프로젝트 생성과 동일, 수정할 필드만 포함)

**Response (200 OK):**

```json
{
  "success": true,
  "data": {
    "project_id": "proj-001",
    "updated_at": "2024-11-10T12:34:56.789Z"
  }
}
```

---

### 5.6. 프로젝트 삭제

```http
DELETE /api/v1/projects/:projectId
```

**Headers:** `Authorization: Bearer <token>`

**Response (200 OK):**

```json
{
  "success": true,
  "message": "Project deleted successfully"
}
```

---

## 6. 팀 빌딩 API (Team Building)

### 6.1. 모집 공고 목록 조회

```http
GET /api/v1/team-building
```

**Query Parameters:**
- `status` (optional): recruiting, closed
- `tech_stack` (optional): 필요 기술 스택
- `page`, `limit`

**Response (200 OK):**

```json
{
  "success": true,
  "data": {
    "posts": [
      {
        "post_id": "tb-001",
        "title": "졸업 작품 웹 개발자 구합니다",
        "project_type": "졸업 작품",
        "required_skills": ["React", "Node.js"],
        "status": "recruiting",
        "deadline": "2024-12-31",
        "author": {
          "user_id": "uuid",
          "name": "홍길동",
          "track": "VC"
        },
        "created_at": "2024-11-10T12:34:56.789Z"
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 23
    }
  }
}
```

---

### 6.2. 모집 공고 생성

```http
POST /api/v1/team-building
```

**Headers:** `Authorization: Bearer <token>`

**Request Body:**

```json
{
  "title": "졸업 작품 웹 개발자 구합니다",
  "description": "VC 트랙 졸업 작품을 위한 프론트엔드 개발자를 찾습니다.",
  "project_type": "졸업 작품",
  "required_skills": ["React", "TypeScript"],
  "deadline": "2024-12-31"
}
```

**Response (201 Created):**

```json
{
  "success": true,
  "data": {
    "post_id": "tb-002",
    "title": "졸업 작품 웹 개발자 구합니다",
    "created_at": "2024-11-10T12:34:56.789Z"
  }
}
```

---

### 6.3. 모집 상태 변경

```http
PATCH /api/v1/team-building/:postId/status
```

**Headers:** `Authorization: Bearer <token>`

**Request Body:**

```json
{
  "status": "closed"
}
```

**Response (200 OK):**

```json
{
  "success": true,
  "data": {
    "post_id": "tb-001",
    "status": "closed"
  }
}
```

---

## 7. 프로필 API (Profile)

### 7.1. 프로필 조회

```http
GET /api/v1/users/:userId/profile
```

**Response (200 OK):**

```json
{
  "success": true,
  "data": {
    "user_id": "uuid",
    "name": "홍길동",
    "email": "student@ajou.ac.kr",
    "student_id": "202221046",
    "track": {
      "track_id": 1,
      "name_ko": "게임앤인터랙티브콘텐츠"
    },
    "grade_level": 4,
    "bio": "게임 개발자를 꿈꾸는 학생입니다.",
    "profile_image": "https://s3.../profile.jpg",
    "external_links": {
      "github": "https://github.com/username",
      "linkedin": "https://linkedin.com/in/username"
    },
    "stats": {
      "projects_count": 12,
      "posts_count": 5,
      "curriculums_count": 2
    }
  }
}
```

---

### 7.2. 프로필 수정

```http
PATCH /api/v1/users/me/profile
```

**Headers:** `Authorization: Bearer <token>`

**Request Body:**

```json
{
  "bio": "게임 개발자를 꿈꾸는 학생입니다.",
  "external_links": {
    "github": "https://github.com/username"
  }
}
```

**Response (200 OK):**

```json
{
  "success": true,
  "data": {
    "user_id": "uuid",
    "updated_at": "2024-11-10T12:34:56.789Z"
  }
}
```

---

### 7.3. Markdown 프로필 업로드

```http
POST /api/v1/users/me/profile/markdown
```

**Headers:** 
- `Authorization: Bearer <token>`
- `Content-Type: multipart/form-data`

**Request Body (FormData):**
- `file`: .md 파일

**Response (200 OK):**

```json
{
  "success": true,
  "data": {
    "markdown_content": "# 홍길동\n게임 개발자...",
    "parsed_sections": {
      "bio": "게임 개발자를 꿈꾸는 학생입니다.",
      "projects": [...]
    }
  }
}
```

---

## 8. 에러 코드 표준화 (Error Code Standardization)

### 8.1. 에러 응답 형식

모든 에러 응답은 다음 형식을 따름:

```json
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "Human-readable error message",
    "details": [
      {
        "field": "field_name",
        "message": "Specific field error message"
      }
    ]
  },
  "timestamp": "2024-11-10T16:00:00.000Z"
}
```

### 8.2. 에러 코드 매핑 테이블

#### 인증 및 권한 관련 에러 (4xx)

| 에러 코드 | HTTP Status | 메시지 | 설명 | 발생 시나리오 |
|----------|-------------|--------|------|--------------|
| `VALIDATION_ERROR` | 400 | Invalid input data | 입력 데이터 검증 실패 | 필수 필드 누락, 형식 오류, 범위 초과 |
| `INVALID_CREDENTIALS` | 401 | Invalid email or password | 이메일 또는 비밀번호 오류 | 로그인 시 잘못된 인증 정보 입력 |
| `UNAUTHORIZED` | 401 | Authentication token is required | 인증 토큰 없음 또는 만료 | 토큰 미제공, 만료된 토큰, 잘못된 토큰 |
| `TOKEN_EXPIRED` | 401 | Token has expired | 토큰 만료 | Access Token 유효기간 초과 |
| `INVALID_TOKEN` | 401 | Invalid authentication token | 유효하지 않은 토큰 | 손상되거나 위조된 토큰 |
| `FORBIDDEN` | 403 | You do not have permission to access this resource | 권한 없음 | 리소스 접근 권한 부족 |
| `INSUFFICIENT_PERMISSIONS` | 403 | Insufficient permissions for this action | 작업 수행 권한 부족 | 역할 기반 권한 미충족 |

#### 리소스 관련 에러 (4xx)

| 에러 코드 | HTTP Status | 메시지 | 설명 | 발생 시나리오 |
|----------|-------------|--------|------|--------------|
| `NOT_FOUND` | 404 | Resource not found | 리소스 없음 | 존재하지 않는 ID로 조회 |
| `USER_NOT_FOUND` | 404 | User not found | 사용자 없음 | 존재하지 않는 사용자 ID |
| `PROJECT_NOT_FOUND` | 404 | Project not found | 프로젝트 없음 | 존재하지 않는 프로젝트 ID |
| `COURSE_NOT_FOUND` | 404 | Course not found | 과목 없음 | 존재하지 않는 과목 ID |
| `CURRICULUM_NOT_FOUND` | 404 | Curriculum not found | 커리큘럼 없음 | 존재하지 않는 커리큘럼 ID |
| `TRACK_NOT_FOUND` | 404 | Track not found | 트랙 없음 | 존재하지 않는 트랙 ID |

#### 중복 및 충돌 관련 에러 (4xx)

| 에러 코드 | HTTP Status | 메시지 | 설명 | 발생 시나리오 |
|----------|-------------|--------|------|--------------|
| `DUPLICATE_EMAIL` | 409 | Email already exists | 이메일 중복 | 이미 등록된 이메일로 회원가입 시도 |
| `DUPLICATE_STUDENT_ID` | 409 | Student ID already exists | 학번 중복 | 이미 등록된 학번으로 회원가입 시도 |
| `DUPLICATE_RESOURCE` | 409 | Resource already exists | 리소스 중복 | 중복된 리소스 생성 시도 |
| `CONFLICT` | 409 | Resource conflict | 리소스 충돌 | 동시 수정으로 인한 충돌 |

#### 파일 업로드 관련 에러 (4xx)

| 에러 코드 | HTTP Status | 메시지 | 설명 | 발생 시나리오 |
|----------|-------------|--------|------|--------------|
| `FILE_TOO_LARGE` | 400 | File size exceeds the limit | 파일 크기 초과 | 10MB 초과 파일 업로드 |
| `INVALID_FILE_TYPE` | 400 | Unsupported file type | 지원하지 않는 파일 형식 | 허용되지 않은 확장자 업로드 |
| `FILE_UPLOAD_FAILED` | 400 | File upload failed | 파일 업로드 실패 | S3 업로드 중 오류 발생 |
| `MISSING_FILE` | 400 | File is required | 파일 누락 | 필수 파일 미제공 |

#### 비즈니스 로직 관련 에러 (4xx)

| 에러 코드 | HTTP Status | 메시지 | 설명 | 발생 시나리오 |
|----------|-------------|--------|------|--------------|
| `PREREQUISITE_NOT_MET` | 400 | Prerequisite course not completed | 선수과목 미이수 | 선수과목 미이수 상태에서 과목 등록 |
| `CREDIT_LIMIT_EXCEEDED` | 400 | Credit limit exceeded | 학점 제한 초과 | 학기당 최대 학점 초과 |
| `INVALID_SEMESTER` | 400 | Invalid semester format | 잘못된 학기 형식 | 학기 형식 오류 (예: "2024-3") |
| `ALREADY_ENROLLED` | 400 | Already enrolled in this course | 이미 수강 중 | 중복 수강 신청 |
| `ENROLLMENT_CLOSED` | 400 | Enrollment period has ended | 수강신청 기간 종료 | 수강신청 기간 외 신청 시도 |

#### Rate Limiting 관련 에러 (4xx)

| 에러 코드 | HTTP Status | 메시지 | 설명 | 발생 시나리오 |
|----------|-------------|--------|------|--------------|
| `RATE_LIMIT_EXCEEDED` | 429 | Too many requests | 요청 횟수 초과 | 15분당 허용 요청 수 초과 |

#### 서버 관련 에러 (5xx)

| 에러 코드 | HTTP Status | 메시지 | 설명 | 발생 시나리오 |
|----------|-------------|--------|------|--------------|
| `INTERNAL_ERROR` | 500 | An unexpected error occurred | 서버 내부 오류 | 예상치 못한 서버 오류 |
| `DATABASE_ERROR` | 500 | Database operation failed | 데이터베이스 오류 | DB 연결 실패, 쿼리 오류 |
| `EXTERNAL_SERVICE_ERROR` | 500 | External service unavailable | 외부 서비스 오류 | S3, 이메일 서비스 등 외부 API 오류 |
| `SERVICE_UNAVAILABLE` | 503 | Service temporarily unavailable | 서비스 일시 중단 | 유지보수, 과부하 등 |

### 8.3. 에러 응답 예시

#### 예시 1: 유효성 검증 실패 (VALIDATION_ERROR)

```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Invalid input data",
    "details": [
      {
        "field": "email",
        "message": "Email format is invalid"
      },
      {
        "field": "password",
        "message": "Password must contain at least 8 characters with letters, numbers, and special characters"
      },
      {
        "field": "student_id",
        "message": "Student ID must be exactly 9 digits"
      }
    ]
  },
  "timestamp": "2024-11-10T16:00:00.000Z"
}
```

#### 예시 2: 인증 실패 (UNAUTHORIZED)

```json
{
  "success": false,
  "error": {
    "code": "UNAUTHORIZED",
    "message": "Authentication token is required",
    "details": []
  },
  "timestamp": "2024-11-10T16:00:00.000Z"
}
```

#### 예시 3: 권한 부족 (FORBIDDEN)

```json
{
  "success": false,
  "error": {
    "code": "FORBIDDEN",
    "message": "You do not have permission to access this resource",
    "details": [
      {
        "field": "user_role",
        "message": "Only PROFESSOR or ADMIN roles can delete projects"
      }
    ]
  },
  "timestamp": "2024-11-10T16:00:00.000Z"
}
```

#### 예시 4: 리소스 없음 (NOT_FOUND)

```json
{
  "success": false,
  "error": {
    "code": "PROJECT_NOT_FOUND",
    "message": "Project not found",
    "details": [
      {
        "field": "project_id",
        "message": "Project with ID proj-999 does not exist"
      }
    ]
  },
  "timestamp": "2024-11-10T16:00:00.000Z"
}
```

#### 예시 5: 중복 데이터 (DUPLICATE_EMAIL)

```json
{
  "success": false,
  "error": {
    "code": "DUPLICATE_EMAIL",
    "message": "Email already exists",
    "details": [
      {
        "field": "email",
        "message": "student@ajou.ac.kr is already registered"
      }
    ]
  },
  "timestamp": "2024-11-10T16:00:00.000Z"
}
```

#### 예시 6: 파일 크기 초과 (FILE_TOO_LARGE)

```json
{
  "success": false,
  "error": {
    "code": "FILE_TOO_LARGE",
    "message": "File size exceeds the limit",
    "details": [
      {
        "field": "file",
        "message": "File size is 15MB. Maximum allowed size is 10MB"
      }
    ]
  },
  "timestamp": "2024-11-10T16:00:00.000Z"
}
```

#### 예시 7: Rate Limit 초과 (RATE_LIMIT_EXCEEDED)

```json
{
  "success": false,
  "error": {
    "code": "RATE_LIMIT_EXCEEDED",
    "message": "Too many requests. Please try again later",
    "details": [
      {
        "field": "retry_after",
        "message": "900 seconds"
      }
    ]
  },
  "timestamp": "2024-11-10T16:00:00.000Z"
}
```

#### 예시 8: 서버 내부 오류 (INTERNAL_ERROR)

```json
{
  "success": false,
  "error": {
    "code": "INTERNAL_ERROR",
    "message": "An unexpected error occurred",
    "details": []
  },
  "timestamp": "2024-11-10T16:00:00.000Z"
}
```

### 8.4. 에러 처리 가이드라인

#### 클라이언트 측 에러 처리

```typescript
async function handleApiCall() {
  try {
    const response = await fetch('/api/v1/projects', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(projectData)
    });
    
    const result = await response.json();
    
    if (!result.success) {
      // 에러 코드별 처리
      switch (result.error.code) {
        case 'UNAUTHORIZED':
        case 'TOKEN_EXPIRED':
          // 토큰 갱신 또는 로그인 페이지로 리다이렉트
          redirectToLogin();
          break;
          
        case 'VALIDATION_ERROR':
          // 유효성 검증 오류 표시
          displayValidationErrors(result.error.details);
          break;
          
        case 'FORBIDDEN':
          // 권한 부족 메시지 표시
          showPermissionDeniedMessage();
          break;
          
        case 'RATE_LIMIT_EXCEEDED':
          // Rate limit 초과 메시지 및 재시도 시간 표시
          const retryAfter = result.error.details[0]?.message;
          showRateLimitMessage(retryAfter);
          break;
          
        default:
          // 일반 에러 메시지 표시
          showErrorMessage(result.error.message);
      }
    }
  } catch (error) {
    // 네트워크 오류 등 예외 처리
    showNetworkErrorMessage();
  }
}
```

#### 서버 측 에러 응답 생성

```typescript
// Express.js 예시
class ApiError extends Error {
  constructor(
    public code: string,
    public message: string,
    public statusCode: number,
    public details: Array<{ field: string; message: string }> = []
  ) {
    super(message);
  }
}

// 에러 핸들러 미들웨어
app.use((err: ApiError, req, res, next) => {
  const statusCode = err.statusCode || 500;
  const errorCode = err.code || 'INTERNAL_ERROR';
  
  res.status(statusCode).json({
    success: false,
    error: {
      code: errorCode,
      message: err.message,
      details: err.details
    },
    timestamp: new Date().toISOString()
  });
});

// 사용 예시
throw new ApiError(
  'VALIDATION_ERROR',
  'Invalid input data',
  400,
  [
    { field: 'email', message: 'Email format is invalid' }
  ]
);
```

---

## 9. Rate Limiting

- **일반 API:** 15분당 100 요청
- **파일 업로드:** 15분당 10 요청
- **인증 API:** 15분당 5 요청

초과 시 응답:

```json
{
  "success": false,
  "error": {
    "code": "RATE_LIMIT_EXCEEDED",
    "message": "Too many requests. Please try again later.",
    "retry_after": 900
  }
}
```

---

## 10. 테스트 케이스 (Test Cases)

### 10.1. 인증 API 테스트 케이스

#### 10.1.1. 회원가입 (POST /api/v1/auth/register)

**정상 케이스:**

| 테스트 ID | 시나리오 | 입력 데이터 | 예상 결과 |
|----------|---------|-----------|----------|
| AUTH-REG-001 | 유효한 데이터로 회원가입 | email: "student@ajou.ac.kr"<br>password: "SecurePass123!"<br>name: "홍길동"<br>student_id: "202221046"<br>major_id: 1<br>track_id: 3<br>grade_level: 2 | 201 Created<br>사용자 생성 성공<br>Access Token 및 Refresh Token 반환 |
| AUTH-REG-002 | 교수 계정 회원가입 | email: "prof@ajou.ac.kr"<br>password: "ProfPass123!"<br>name: "김교수"<br>role: "PROFESSOR" | 201 Created<br>교수 계정 생성 성공 |

**예외 케이스:**

| 테스트 ID | 시나리오 | 입력 데이터 | 예상 결과 |
|----------|---------|-----------|----------|
| AUTH-REG-E001 | 이메일 형식 오류 | email: "invalid-email" | 400 Bad Request<br>VALIDATION_ERROR<br>"Email format is invalid" |
| AUTH-REG-E002 | 비밀번호 길이 부족 | password: "short" | 400 Bad Request<br>VALIDATION_ERROR<br>"Password must be at least 8 characters" |
| AUTH-REG-E003 | 필수 필드 누락 | email 필드 누락 | 400 Bad Request<br>VALIDATION_ERROR<br>"Email is required" |
| AUTH-REG-E004 | 중복 이메일 | 이미 존재하는 email | 409 Conflict<br>DUPLICATE_EMAIL |
| AUTH-REG-E005 | 중복 학번 | 이미 존재하는 student_id | 409 Conflict<br>DUPLICATE_STUDENT_ID |
| AUTH-REG-E006 | 존재하지 않는 트랙 | track_id: 999 | 404 Not Found<br>TRACK_NOT_FOUND |

**경계값 케이스:**

| 테스트 ID | 시나리오 | 입력 데이터 | 예상 결과 |
|----------|---------|-----------|----------|
| AUTH-REG-B001 | 최소 비밀번호 길이 | password: "Pass123!" (8자) | 201 Created |
| AUTH-REG-B002 | 최대 이름 길이 | name: 50자 문자열 | 201 Created |
| AUTH-REG-B003 | 학번 9자리 정확히 | student_id: "202221046" | 201 Created |
| AUTH-REG-B004 | 학번 8자리 (부족) | student_id: "20222104" | 400 Bad Request |

#### 10.1.2. 로그인 (POST /api/v1/auth/login)

**정상 케이스:**

| 테스트 ID | 시나리오 | 입력 데이터 | 예상 결과 |
|----------|---------|-----------|----------|
| AUTH-LOGIN-001 | 유효한 인증 정보로 로그인 | email: "student@ajou.ac.kr"<br>password: "SecurePass123!" | 200 OK<br>사용자 정보 및 토큰 반환 |
| AUTH-LOGIN-002 | 교수 계정 로그인 | email: "prof@ajou.ac.kr"<br>password: "ProfPass123!" | 200 OK<br>role: "PROFESSOR" |

**예외 케이스:**

| 테스트 ID | 시나리오 | 입력 데이터 | 예상 결과 |
|----------|---------|-----------|----------|
| AUTH-LOGIN-E001 | 잘못된 비밀번호 | 올바른 email, 잘못된 password | 401 Unauthorized<br>INVALID_CREDENTIALS |
| AUTH-LOGIN-E002 | 존재하지 않는 이메일 | 미등록 email | 401 Unauthorized<br>INVALID_CREDENTIALS |
| AUTH-LOGIN-E003 | 필수 필드 누락 | password 필드 누락 | 400 Bad Request<br>VALIDATION_ERROR |

#### 10.1.3. 토큰 갱신 (POST /api/v1/auth/refresh)

**정상 케이스:**

| 테스트 ID | 시나리오 | 입력 데이터 | 예상 결과 |
|----------|---------|-----------|----------|
| AUTH-REFRESH-001 | 유효한 Refresh Token으로 갱신 | 유효한 refreshToken | 200 OK<br>새로운 Access Token 반환 |

**예외 케이스:**

| 테스트 ID | 시나리오 | 입력 데이터 | 예상 결과 |
|----------|---------|-----------|----------|
| AUTH-REFRESH-E001 | 만료된 Refresh Token | 만료된 refreshToken | 401 Unauthorized<br>UNAUTHORIZED |
| AUTH-REFRESH-E002 | 잘못된 Refresh Token | 손상된 refreshToken | 401 Unauthorized<br>INVALID_TOKEN |
| AUTH-REFRESH-E003 | Refresh Token 누락 | refreshToken 필드 없음 | 400 Bad Request<br>VALIDATION_ERROR |

### 10.2. 프로젝트 API 테스트 케이스

#### 10.2.1. 프로젝트 목록 조회 (GET /api/v1/projects)

**정상 케이스:**

| 테스트 ID | 시나리오 | Query Parameters | 예상 결과 |
|----------|---------|-----------------|----------|
| PROJ-LIST-001 | 전체 프로젝트 조회 | 없음 | 200 OK<br>프로젝트 목록 반환<br>기본 페이지네이션 (page=1, limit=20) |
| PROJ-LIST-002 | 트랙별 필터링 | track_type=GI | 200 OK<br>GI 트랙 프로젝트만 반환 |
| PROJ-LIST-003 | 기술 스택 필터링 | tech_stack=React,Node.js | 200 OK<br>React 또는 Node.js 포함 프로젝트 반환 |
| PROJ-LIST-004 | 정렬 옵션 | sort=popular | 200 OK<br>인기순 정렬 |
| PROJ-LIST-005 | 페이지네이션 | page=2&limit=10 | 200 OK<br>2페이지, 10개 항목 |

**경계값 케이스:**

| 테스트 ID | 시나리오 | Query Parameters | 예상 결과 |
|----------|---------|-----------------|----------|
| PROJ-LIST-B001 | 최대 limit 값 | limit=100 | 200 OK<br>최대 100개 항목 |
| PROJ-LIST-B002 | limit 초과 | limit=150 | 400 Bad Request<br>VALIDATION_ERROR<br>"Limit cannot exceed 100" |
| PROJ-LIST-B003 | 음수 페이지 | page=-1 | 400 Bad Request<br>VALIDATION_ERROR |
| PROJ-LIST-B004 | 빈 결과 | 존재하지 않는 필터 조합 | 200 OK<br>빈 배열 반환 |

#### 10.2.2. 프로젝트 생성 (POST /api/v1/projects)

**정상 케이스:**

| 테스트 ID | 시나리오 | 입력 데이터 | 예상 결과 |
|----------|---------|-----------|----------|
| PROJ-CREATE-001 | 유효한 데이터로 프로젝트 생성 | title: "Media Weave"<br>summary: "학과 플랫폼"<br>track_type: "GI"<br>tech_stacks: ["React"]<br>+ 인증 토큰 | 201 Created<br>프로젝트 생성 성공 |
| PROJ-CREATE-002 | 이미지 파일 포함 생성 | 프로젝트 데이터 + 이미지 파일 | 201 Created<br>이미지 업로드 성공 |

**예외 케이스:**

| 테스트 ID | 시나리오 | 입력 데이터 | 예상 결과 |
|----------|---------|-----------|----------|
| PROJ-CREATE-E001 | 인증 토큰 없음 | 유효한 데이터, 토큰 없음 | 401 Unauthorized<br>UNAUTHORIZED |
| PROJ-CREATE-E002 | 필수 필드 누락 | title 필드 누락 | 400 Bad Request<br>VALIDATION_ERROR |
| PROJ-CREATE-E003 | 파일 크기 초과 | 15MB 이미지 파일 | 400 Bad Request<br>FILE_TOO_LARGE |
| PROJ-CREATE-E004 | 지원하지 않는 파일 형식 | .exe 파일 | 400 Bad Request<br>INVALID_FILE_TYPE |

### 10.3. 커리큘럼 API 테스트 케이스

#### 10.3.1. 커리큘럼 생성 (POST /api/v1/curriculums)

**정상 케이스:**

| 테스트 ID | 시나리오 | 입력 데이터 | 예상 결과 |
|----------|---------|-----------|----------|
| CURR-CREATE-001 | 유효한 커리큘럼 생성 | title: "GI 4년 플랜"<br>semesters: {...}<br>isPublic: false<br>+ 인증 토큰 | 201 Created<br>커리큘럼 생성 성공 |
| CURR-CREATE-002 | 공개 커리큘럼 생성 | isPublic: true | 201 Created<br>공개 커리큘럼 생성 |

**예외 케이스:**

| 테스트 ID | 시나리오 | 입력 데이터 | 예상 결과 |
|----------|---------|-----------|----------|
| CURR-CREATE-E001 | 인증 토큰 없음 | 유효한 데이터, 토큰 없음 | 401 Unauthorized |
| CURR-CREATE-E002 | 존재하지 않는 과목 ID | course_id: 999 | 404 Not Found<br>COURSE_NOT_FOUND |
| CURR-CREATE-E003 | 선수과목 미이수 | 선수과목 없이 고급 과목 추가 | 400 Bad Request<br>PREREQUISITE_NOT_MET |

### 10.4. 권한 테스트 케이스

#### 10.4.1. 역할 기반 접근 제어

| 테스트 ID | 시나리오 | 사용자 역할 | 요청 | 예상 결과 |
|----------|---------|-----------|------|----------|
| AUTH-RBAC-001 | 학생이 자신의 프로젝트 수정 | STUDENT | PATCH /projects/:id (본인) | 200 OK |
| AUTH-RBAC-002 | 학생이 타인의 프로젝트 수정 시도 | STUDENT | PATCH /projects/:id (타인) | 403 Forbidden |
| AUTH-RBAC-003 | 교수가 과목 정보 수정 | PROFESSOR | PATCH /courses/:id | 200 OK |
| AUTH-RBAC-004 | 학생이 과목 정보 수정 시도 | STUDENT | PATCH /courses/:id | 403 Forbidden |
| AUTH-RBAC-005 | 관리자가 모든 프로젝트 삭제 | ADMIN | DELETE /projects/:id (타인) | 200 OK |

### 10.5. 통합 테스트 시나리오

#### 10.5.1. 사용자 여정: 회원가입부터 프로젝트 등록까지

```
1. POST /api/v1/auth/register
   → 201 Created, Access Token 획득
   
2. GET /api/v1/tracks
   → 200 OK, 트랙 목록 조회
   
3. POST /api/v1/curriculums
   → 201 Created, 커리큘럼 생성
   
4. POST /api/v1/projects (with files)
   → 201 Created, 프로젝트 등록
   
5. GET /api/v1/projects/my
   → 200 OK, 내 프로젝트 목록 확인
```

#### 10.5.2. 토큰 만료 및 갱신 시나리오

```
1. POST /api/v1/auth/login
   → Access Token (1시간), Refresh Token (30일) 획득
   
2. GET /api/v1/projects (1시간 후)
   → 401 Unauthorized (Access Token 만료)
   
3. POST /api/v1/auth/refresh
   → 200 OK, 새로운 Access Token 획득
   
4. GET /api/v1/projects (재시도)
   → 200 OK, 정상 조회
```

### 10.6. 성능 테스트 케이스

| 테스트 ID | 시나리오 | 목표 | 측정 지표 |
|----------|---------|------|----------|
| PERF-001 | API 응답 시간 | P95 < 200ms | 응답 시간 |
| PERF-002 | 동시 접속자 처리 | 1,000명 동시 접속 | TPS, 에러율 |
| PERF-003 | 대용량 파일 업로드 | 10MB 파일 업로드 < 5초 | 업로드 시간 |
| PERF-004 | 페이지네이션 성능 | 10,000개 데이터 조회 | 쿼리 시간 |

### 10.7. 보안 테스트 케이스

| 테스트 ID | 시나리오 | 공격 유형 | 예상 결과 |
|----------|---------|----------|----------|
| SEC-001 | SQL Injection 시도 | SQL Injection | 400 Bad Request, 쿼리 실행 안됨 |
| SEC-002 | XSS 공격 시도 | XSS | 입력 값 이스케이프 처리 |
| SEC-003 | CSRF 공격 시도 | CSRF | 403 Forbidden, CSRF 토큰 검증 |
| SEC-004 | 무차별 대입 공격 | Brute Force | Rate Limit 적용, 429 Too Many Requests |
| SEC-005 | 권한 상승 시도 | Privilege Escalation | 403 Forbidden |

## 11. Pagination

모든 목록 조회 API는 페이지네이션을 지원함

**Query Parameters:**
- `page`: 페이지 번호 (default: 1)
- `limit`: 페이지 크기 (default: 20, max: 100)

**Response Format:**

```json
{
  "data": [...],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 87,
    "total_pages": 5
  }
}
```

---

---

## 11. 공통 에러 응답 예시

모든 API 엔드포인트는 다음과 같은 표준화된 에러 응답 형식을 사용함

### 11.1. 400 Bad Request - 유효성 검증 실패

```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Invalid input data",
    "details": [
      {
        "field": "email",
        "message": "Email format is invalid"
      },
      {
        "field": "password",
        "message": "Password must be at least 8 characters"
      }
    ]
  },
  "timestamp": "2024-11-10T16:00:00.000Z"
}
```

### 11.2. 401 Unauthorized - 인증 실패

```json
{
  "success": false,
  "error": {
    "code": "UNAUTHORIZED",
    "message": "Authentication token is required",
    "details": []
  },
  "timestamp": "2024-11-10T16:00:00.000Z"
}
```

### 11.3. 403 Forbidden - 권한 없음

```json
{
  "success": false,
  "error": {
    "code": "FORBIDDEN",
    "message": "You do not have permission to access this resource",
    "details": [
      {
        "field": "user_role",
        "message": "Only PROFESSOR or ADMIN roles can perform this action"
      }
    ]
  },
  "timestamp": "2024-11-10T16:00:00.000Z"
}
```

### 11.4. 404 Not Found - 리소스 없음

```json
{
  "success": false,
  "error": {
    "code": "NOT_FOUND",
    "message": "Resource not found",
    "details": [
      {
        "field": "project_id",
        "message": "Project with ID proj-999 does not exist"
      }
    ]
  },
  "timestamp": "2024-11-10T16:00:00.000Z"
}
```

### 11.5. 409 Conflict - 중복 데이터

```json
{
  "success": false,
  "error": {
    "code": "DUPLICATE_EMAIL",
    "message": "Email already exists",
    "details": [
      {
        "field": "email",
        "message": "student@ajou.ac.kr is already registered"
      }
    ]
  },
  "timestamp": "2024-11-10T16:00:00.000Z"
}
```

### 11.6. 500 Internal Server Error - 서버 오류

```json
{
  "success": false,
  "error": {
    "code": "INTERNAL_ERROR",
    "message": "An unexpected error occurred",
    "details": []
  },
  "timestamp": "2024-11-10T16:00:00.000Z"
}
```

---

## 부록: 개발 가이드

### Postman Collection

API 테스트를 위한 Postman Collection을 제공함:

```bash
# Collection 다운로드
curl -o mediaweave-api.postman_collection.json \
  https://api.mediaweave.ajou.ac.kr/docs/postman
```

### API 버전 관리

- 현재 버전: `v1`
- Breaking Change 발생 시 `v2` 출시 예정
- 구버전은 최소 6개월간 지원
